<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blog POST Form</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />

  <!-- Include Quill script -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 30px auto;
      padding: 0 10px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input[type='text'],
    input[type='number'],
    input[type='datetime-local'],
    select,
    textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    textarea {
      resize: vertical;
      height: 100px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }
    /* Make large editors span full width */
    label.editor-container {
      grid-column: span 2;
    }
    #responseOutput {
      margin-top: 20px;
      white-space: pre-wrap;
      background: #f0f0f0;
      padding: 15px;
      border-radius: 4px;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h1>Create Blog Post</h1>
  <form id="blogForm" enctype="multipart/form-data">
    <label>
      Title (English)
      <input type="text" name="title_en" required />
    </label>

    <label>
      Title (Arabic)
      <input type="text" name="title_ar" required />
    </label>

    <label class="editor-container">
      Content (English)
      <div id="editor_en" style="height: 200px; background: white;"></div>
      <input type="hidden" name="content_en" id="content_en" />
    </label>

    <label class="editor-container">
      Content (Arabic)
      <div id="editor_ar" style="height: 200px; background: white;"></div>
      <input type="hidden" name="content_ar" id="content_ar" />
    </label>

    <label>
      Meta Title
      <input type="text" name="meta_title" />
    </label>

    <label>
      Meta Description
      <textarea name="meta_description"></textarea>
    </label>

    <label>
      Author
      <input type="text" name="author" />
    </label>

    <label>
      Status
      <select name="status" required>
        <option value="published">Published</option>
        <option value="draft">Draft</option>
      </select>
    </label>

    <label>
      Published At
      <input type="datetime-local" name="published_at" />
    </label>

    <label>
      Tags (comma separated)
      <input type="text" name="tags" placeholder="e.g. branding,digital marketing" />
    </label>

    <label>
      Meta Keywords (comma separated)
      <input type="text" name="meta_keywords" placeholder="e.g. marketing,brand strategy" />
    </label>

    <label>
      Image Upload
      <input type="file" name="image" accept="image/*" />
    </label>

    <label>
      Department ID
      <input type="number" name="department_id" />
    </label>

    <button type="submit">Submit Blog Post</button>
  </form>

  <pre id="responseOutput"></pre>

  <script>
    // Initialize Quill editors
    var quill_en = new Quill('#editor_en', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline', 'strike'],
          ['link', 'image'],
          [{ list: 'ordered' }, { list: 'bullet' }],
          [{ direction: 'rtl' }],
          [{ align: [] }],
          ['clean'],
        ],
      },
    });

    var quill_ar = new Quill('#editor_ar', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline', 'strike'],
          ['link', 'image'],
          [{ list: 'ordered' }, { list: 'bullet' }],
          [{ direction: 'rtl' }],
          [{ align: [] }],
          ['clean'],
        ],
      },
    });

    const form = document.getElementById('blogForm');
    const responseOutput = document.getElementById('responseOutput');

    form.addEventListener('submit', async e => {
      e.preventDefault();

      // Update hidden inputs with Quill HTML content before submission
      document.getElementById('content_en').value = quill_en.root.innerHTML;
      document.getElementById('content_ar').value = quill_ar.root.innerHTML;

      const formData = new FormData();

      formData.append('title[en]', form.title_en.value );
      formData.append('title[ar]', form.title_en.value );
	  
	  
      formData.append('content[en]', form.content_en.value, );


      formData.append('slug', form.meta_title.value);
      formData.append('meta_title', form.meta_title.value);
      formData.append('meta_description', form.meta_description.value);
      formData.append('author', form.author.value);
      formData.append('image_alt', form.author.value);
      formData.append('status', form.status.value);
      formData.append('departmentId', 1);

      if (form.published_at.value) {
        formData.append('published_at', new Date(form.published_at.value).toISOString());
      }


      formData.append('tags[0]', "tag1");
      formData.append('meta_keywords[0]', "tag2")

      // Department object with id only

      if (form.image.files.length > 0) {
        formData.append('image', form.image.files[0]);
      }

      try {
        const res = await fetch('http://localhost:8081/api/v1/blogs', {
          method: 'POST',
          body: formData,
        });

        const json = await res.json();
        responseOutput.textContent = JSON.stringify(json, null, 2);
      } catch (err) {
        responseOutput.textContent = 'Error: ' + err.message;
      }
    });
  </script>
</body>
</html>
